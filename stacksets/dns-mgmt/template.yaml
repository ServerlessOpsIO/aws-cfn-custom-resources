AWSTemplateFormatVersion: '2010-09-09'
Description: DNS zone management

Parameters:
  AwsOrganizationId:
    Type: String
    Description: AWS Organization ID
  ManageDnsZoneIamRole:
    Type: String
    Description: IAM role name
  CicdAwsAccountId:
    Type: String
    Description: "ID of CI/CD account"

Resources:
  ManageDnsZoneIamrole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: !Ref ManageDnsZoneIamRole
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Effect: Allow
            Principal:
              AWS: !Sub arn:aws:iam::${CicdAwsAccountId}:root
            Action: sts:AssumeRole
            Condition:
              StringEquals:
                aws:PrincipalOrgID: !Ref AwsOrganizationId
      Policies:
        - PolicyName: ModifyZoneRecords
          PolicyDocument:
            Version: '2012-10-17'
            Statement:
              - Effect: Allow
                Action:
                  - route53:ChangeResourceRecordSets
                Resource: '*'